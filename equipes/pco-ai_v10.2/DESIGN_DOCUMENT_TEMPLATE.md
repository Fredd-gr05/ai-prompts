# DESIGN_DOCUMENT TEMPLATE

> **Este Ã© um template padronizado para que o Prism gere DESIGN_DOCUMENT.md consistente e estruturado.**
> **Prism: Siga EXATAMENTE este template quando gerar a arquitetura do projeto.**

---

# Design Document - [PROJECT_NAME]

## ğŸ“‹ Metadata

| Campo | Valor |
|-------|-------|
| **Project Name** | [Nome do projeto] |
| **Generated By** | Prism |
| **Generated Date** | [YYYY-MM-DD HH:MM UTC-3] |
| **Based On** | [Spectrum Specification Document] |
| **Status** | READY_FOR_SCHEMA |
| **Total Files** | N arquivos |
| **Stack** | [Python/Node.js/Rust] |
| **Framework** | [FastAPI/Express/NestJS/Django] |
| **Database** | [PostgreSQL/MongoDB] |

---

## ğŸ¯ Executive Summary

[2-3 parÃ¡grafos resumindo:
- Objetivo do projeto
- Tecnologias principais
- Componentes-chave
- Resultado esperado]

**Exemplo:**
> Este projeto implementa um sistema de orquestraÃ§Ã£o de agentes IA usando LangChain + CrewAI. A arquitetura Ã© modular, escalÃ¡vel e pronta para produÃ§Ã£o com Docker. O sistema processa requisiÃ§Ãµes assÃ­ncronas e coordena mÃºltiplos agentes especializados em tarefas especÃ­ficas.

---

## ğŸ—ï¸ Arquitetura de Alto NÃ­vel

[DescriÃ§Ã£o narrativa da arquitetura - sem diagramas, em texto]

**Exemplo:**
```
O sistema Ã© dividido em 3 camadas:

1. **API Layer** (FastAPI)
   - Endpoint /api/tasks para receber requisiÃ§Ãµes
   - AutenticaÃ§Ã£o JWT
   - Rate limiting

2. **Orchestration Layer** (CrewAI)
   - Manager Agent (coordena fluxo)
   - Specialist Agents (executam tarefas)
   - Memory Manager (persiste contexto)

3. **Integration Layer**
   - LLM Client (OpenAI/Claude)
   - Database Client (PostgreSQL)
   - Cache Client (Redis)
```

---

## ğŸ“ Estrutura de DiretÃ³rios

```
project_root/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py                          # Entry point da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ settings.py                  # ConfiguraÃ§Ãµes e variÃ¡veis de ambiente
â”‚   â”‚   â””â”€â”€ logging.py                   # Setup de logging
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes.py                    # Rotas FastAPI
â”‚   â”‚   â””â”€â”€ middleware.py                # Middleware customizado
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_agent.py                # Classe base para agentes
â”‚   â”‚   â”œâ”€â”€ manager_agent.py             # Agent de coordenaÃ§Ã£o
â”‚   â”‚   â””â”€â”€ specialist_agent.py          # Agentes especializados
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ domain.py                    # Modelos de domÃ­nio
â”‚   â”‚   â””â”€â”€ api_models.py                # Pydantic models para API
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ llm_service.py               # IntegraÃ§Ã£o com LLM
â”‚   â”‚   â”œâ”€â”€ database_service.py          # OperaÃ§Ãµes de BD
â”‚   â”‚   â””â”€â”€ cache_service.py             # Cache operations
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ validators.py                # Validadores customizados
â”‚   â”‚   â”œâ”€â”€ exceptions.py                # ExceÃ§Ãµes da aplicaÃ§Ã£o
â”‚   â”‚   â””â”€â”€ helpers.py                   # FunÃ§Ãµes auxiliares
â”‚   â””â”€â”€ db/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ models.py                    # SQLAlchemy models
â”‚       â””â”€â”€ migrations/                  # Alembic migrations
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ test_agents.py
â”‚   â”‚   â””â”€â”€ test_services.py
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â””â”€â”€ test_api_endpoints.py
â”‚   â””â”€â”€ conftest.py                      # Pytest fixtures
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md                           # API documentation
â”‚   â”œâ”€â”€ ARCHITECTURE.md                  # Architecture details
â”‚   â””â”€â”€ DEPLOYMENT.md                    # Deployment guide
â”œâ”€â”€ .env.example                         # Exemplo de variÃ¡veis de ambiente
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt                     # Dependencies Python
â”œâ”€â”€ docker-compose.yml                   # Docker Compose configuration
â”œâ”€â”€ Dockerfile                           # Docker image build
â”œâ”€â”€ README.md                            # Project README
â””â”€â”€ pyproject.toml                       # Project metadata (optional)
```

---

## ğŸ“„ EspecificaÃ§Ã£o de Arquivos

### 1ï¸âƒ£ Arquivo: `src/main.py`

**PropÃ³sito:** Entry point da aplicaÃ§Ã£o. Inicializa FastAPI, carrega configuraÃ§Ãµes, registra rotas.

**Responsabilidade:** Startup, Shutdown, middleware registration

**DependÃªncias:**
- Internas: `config.settings`, `api.routes`, `utils.exceptions`
- Externas: `fastapi`, `uvicorn`
- VariÃ¡veis de ambiente: `DEBUG`, `HOST`, `PORT`, `LOG_LEVEL`

**Tipo TÃ©cnico:** Orchestrator / Entry Point

```python
# CÃ³digo base gerado pelo Prism
from fastapi import FastAPI
from fastapi.middleware import CORSMiddleware
from src.config.settings import settings
from src.config.logging import setup_logging
from src.api.routes import router
from src.utils.exceptions import http_exception_handler

# Setup
setup_logging()
app = FastAPI(
    title="[Project Name]",
    description="Multi-agent orchestration system",
    version="1.0.0"
)

# Middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Routes
app.include_router(router, prefix="/api", tags=["tasks"])

# Exception handlers
app.add_exception_handler(Exception, http_exception_handler)

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(
        app,
        host=settings.HOST,
        port=settings.PORT,
        reload=settings.DEBUG
    )
```

**Notas para Schema:**
- Adicionar type hints completos
- Definir FastAPI app instance type
- Adicionar dependency injection setup
- Definir lifespan events se necessÃ¡rio

---

### 2ï¸âƒ£ Arquivo: `src/config/settings.py`

**PropÃ³sito:** Centralizar todas as configuraÃ§Ãµes da aplicaÃ§Ã£o. Ler variÃ¡veis de ambiente.

**Responsabilidade:** Configuration management, environment loading

**DependÃªncias:**
- Internas: Nenhuma
- Externas: `pydantic`, `pydantic_settings`, `python-dotenv`
- VariÃ¡veis de ambiente: (veja `.env.example`)

**Tipo TÃ©cnico:** Configuration / Singleton

```python
# CÃ³digo base
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # Application
    DEBUG: bool = False
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    LOG_LEVEL: str = "INFO"
    
    # Database
    DATABASE_URL: str
    DB_POOL_SIZE: int = 5
    
    # LLM
    OPENAI_API_KEY: str
    LLM_MODEL: str = "gpt-4"
    
    # CORS
    CORS_ORIGINS: list[str] = ["http://localhost:3000"]
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

**Notas para Schema:**
- Adicionar Pydantic v2 validators
- Definir Field descriptions
- Adicionar default factories se necessÃ¡rio

---

### 3ï¸âƒ£ Arquivo: `src/api/routes.py`

**PropÃ³sito:** Definir rotas FastAPI e handlers.

**Responsabilidade:** HTTP endpoints, request/response handling

**DependÃªncias:**
- Internas: `agents.manager_agent`, `models.api_models`, `utils.validators`
- Externas: `fastapi`

**Tipo TÃ©cnico:** API / Router

```python
from fastapi import APIRouter, HTTPException, Depends
from src.models.api_models import TaskRequest, TaskResponse
from src.agents.manager_agent import ManagerAgent

router = APIRouter()

@router.post("/tasks", response_model=TaskResponse)
async def create_task(request: TaskRequest) -> TaskResponse:
    """Create and execute a new task"""
    try:
        manager = ManagerAgent()
        result = await manager.execute(request.task_description)
        return TaskResponse(id=result.id, output=result.output)
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

**Notas para Schema:**
- Definir request/response schemas com Pydantic
- Adicionar validaÃ§Ã£o de input
- Documentar com docstrings

---

## ğŸ”— Mapa de DependÃªncias

```
main.py
â”œâ”€â”€ config/settings.py
â”œâ”€â”€ api/routes.py
â”‚   â”œâ”€â”€ agents/manager_agent.py
â”‚   â”‚   â””â”€â”€ agents/specialist_agent.py
â”‚   â”‚       â””â”€â”€ services/llm_service.py
â”‚   â””â”€â”€ models/api_models.py
â””â”€â”€ config/logging.py

services/llm_service.py
â”œâ”€â”€ config/settings.py
â””â”€â”€ models/domain.py

services/database_service.py
â”œâ”€â”€ config/settings.py
â””â”€â”€ db/models.py
```

---

## ğŸš€ VariÃ¡veis de Ambiente

**Arquivo: `.env.example`**

```bash
# Application
DEBUG=true
HOST=0.0.0.0
PORT=8000
LOG_LEVEL=DEBUG

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
DB_POOL_SIZE=5

# LLM
OPENAI_API_KEY=sk-...
LLM_MODEL=gpt-4

# Redis
REDIS_URL=redis://localhost:6379/0

# CORS
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080"]
```

---

## ğŸ“¦ DependÃªncias (requirements.txt)

```
fastapi==0.104.1
uvicorn==0.24.0
pydantic==2.4.2
pydantic-settings==2.0.3
python-dotenv==1.0.0
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
redis==5.0.1
openai==1.3.5
langchain==0.1.0
crewai==0.1.0
```

---

## ğŸ³ Docker & Compose

**Dockerfile e docker-compose.yml devem estar presentes e configurados.**

---

## âœ… Checklist de ValidaÃ§Ã£o Prism

**Prism deve garantir:**

- [ ] Todos os arquivos listados na "Estrutura de DiretÃ³rios" estÃ£o documentados
- [ ] Cada arquivo tem seÃ§Ã£o dedicada com: PropÃ³sito, Responsabilidade, DependÃªncias, CÃ³digo base
- [ ] DependÃªncias entre arquivos formam DAG (sem ciclos)
- [ ] CÃ³digo base Ã© sintaticamente correto Python/JavaScript
- [ ] VariÃ¡veis de ambiente estÃ£o todas em `.env.example`
- [ ] `requirements.txt` ou `package.json` estÃ¡ preenchido
- [ ] Docker setup estÃ¡ pronto
- [ ] Nenhum arquivo faz referÃªncia a arquivo inexistente
- [ ] Documento estÃ¡ em MARKDOWN estruturado vÃ¡lido
- [ ] Status: **READY_FOR_SCHEMA** (ao final)

---

## ğŸ”„ Status

**Status Atual:** READY_FOR_SCHEMA âœ…

> Documento pronto para Schema adicionar tipos, contratos e validaÃ§Ã£o.

---

## ğŸ“ Notas

- Este Ã© um TEMPLATE - Prism deve adaptÃ¡-lo ao projeto especÃ­fico
- Adicionar/remover seÃ§Ãµes conforme necessÃ¡rio
- Manter estrutura geral consistente
- Sempre terminar com Status = READY_FOR_SCHEMA
